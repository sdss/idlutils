
ASINH: Copy in Landsman's latest version.
COUNT_FREELUN: New function to count the number of logical file pointers
               (LUNs) that are available.  This is to be called by DJS_BATCH.
DIERFC: New math function for erfc.
DJS_BATCH: Add a call to COUNT_FREELUN().  Do not try to use more hosts than
               there are free file pointers (LUNs) due to a limitation in
               executing the SPAWN command.
EMBED_STAMP: New procedure to take one image and add it to another, starting
               at an arbitrary position (SSHIFTing appropriately) without 
               rotation. 
GVERTS: Bug fix for the case of single-cap polygons.
HELIO_TO_LG: Fixed sign error in correction
IDLUTILS_SO_EXT: New function to return the appropriate dynamic library
               extension given architecture.
MULTI_PSF_FIT: New procedure which, given an image and a PSF, finds the
               best fit combination of N PSFs which explains the image
               (user supplies number of desired PSFs N).
NW_ARCSINH: Changes to use less memory.
NW_RGB_MAKE: add new keyword COLORS to pass back final colors used for jpg
RADEC_GREATCIRCLE: In the internal function RADEC_GCFN, return the
               concatenation of all the chi values in both mu+nu,
               rather than some quatrature sum of the chi^2's.
               This seems to result in much better convergence,
               especially for those runs where we don't have a good
               starting guess.
SPLOT: add xoffset and yoffset keywords which position splot on the 
       screen where you want it
VMIDC,idl_vmidc.c,vmid.c: New function to return the central vector in
               a polygon.
XY2TRACESET: A bug was found by Andy Marble (Arizona): The input mask
               was basically being ignored in all cases!
UNDEFINE: Fanning procedure to wrap TEMPORARY calls to delete variables
WHERE_POLYGONS_OVERLAP: Add optional output AREAMATCH.

data/sdss/sdssMaskbits.par: Remove the RESOLVE bits, which have been deprecated
               with the RESOLVE_STATUS mask bits.                            
               Add Q_EYEBALL and T_EYEBALL, eyeball quality and 
               type bitmasks for SDSS galaxies
src/idlmangle/Makefile: Add idl_garea.o
               Change the order of the line that does linking from
               "-lmangle -L$(IDLUTILS_DIR)/lib" to
               "-L$(IDLUTILS_DIR)/lib -lmangle".  This seems to make a
               difference on the SGI platform (hecate.princeton), but
               makes no difference under Linux.
               Link to "libmangle.a" instead of "libmangle.$(SO_EXT)",
               in accordance with the explicit naming of that library.
src/idlmangle/where_polygons_overlap.c: Compute and return the overlap area.
src/image/grow_obj.c: Comment-out "ny" because it isn't actually used.
src/mangle1.4/src/Makefile: Change the output library name from
               "libmangle.$(SO_EXT)" to explicitly be "libmangle.a"
               (as used to be the case) because that seems to be the
               only way to get this to build under Darwin and IRIX (SGIs).
src/mangle1.4/src/mrb_balkanize.c: Print output status in stage 2.
src/mangle1.4/src/msg.c: Add the include for <stdarg.h>, since it it needed
               to build on the IRIX platform (on hecate.princeton).
               It seems safe to have that include on Linux or Darwin also.

-------------------------------------------------------------------------------
v5_0_0 (Feb 19, 2004) running on IDL 5.4 - 6.0
Tagged for idlspec2d v5_0_0.

BSPLINE_ITERFIT: Set all the SSET.BKMASK=1 (good) for the case that the break
               points are passed through the OLDSET keyword.
REBIN_SPECTRUM: New function for rebinning 1-D spectra using CIC assignment
               and arbitrary pixel boundaries.
TRACESET_TRIM: New function for trimming trace sets to selected traces.

Makefile: Add include directory.
bin/evilmake: Change build flags on the SGI platform (IRIX64) to be 64-bit
               instead of 32-bit.  This involves adding "-64" and "-mips4"
               flags.
bin/Makefile: Should have "-n32" instead of "-32" in the X_FFLAGS
               for the IRIX64 platform, to avoid inconsistencies with
               the other compiler flags.
include/export.h: This include file used to exist in six places under /src,
               but now I am consolodating into this one place.
               Two changes to the file to treat the "sgi" platform like
               other 64-bit platforms.
               Remove this file from src/idlmangle, src/image, src/math,
               src/slatec, src/spheregroup, src/slatec.
include/Makefile: New directory for IDL<->C include file.
src/{idlmangle,mangle1.4/src}/Makefile: Change the instances of "libmangle.a"
               with "libmangle.$(SO_EXT)" so that we get ".a" extensions
               on some platforms, and ".so" extensions on others.  This is
               how our other built libraries work.
src/idlmangle/idl_garea.c,idl_gvers.c,idl_vmid.c,idl_where_polygons_overlap.c:
               Recaste some "int" with "IDL_LONG" where not consistent.
               This was crashing the build on the SGI platform.
               Also, remove some unused variables.
src/{idlmangle,image,math,slatec,spheregroup,trace}/Makefile: Changed the
               location of the include file to "../../include".
src/image/Makefile: Change some of the comment lines, since for some bizarre
               reason those comment lines that end in a backslash will crash
               on the SGI IRIX platform.
src/mangle1.4/src/Makefile: Simplify line 80 of the Makefile such that this
               will build on the SGI platform.  This meant stripping out the
               fancy bit of code that extracts the list of objects in
               the libmangle.a library.
src/trace/evilmath.c: Get rid of "sumf" variable which is unused.

-------------------------------------------------------------------------------
v4_10_8 (Jan 4, 2004)
Tagged for sirtf v0_0_2

GAUSS_OVERLAP: New function to calculate log integral, covariance, and
               mean of product of two gaussians.
NW_RGB_MAKE: Top-level routine for making color images from 3 color images.

bin/evilmake: Add "LDF77=g77" or "LDF77=ld", and export it.
scr/idlmangle/Makefile: Change of $(FC) -> $(LDF77) on link line, so
               that this builds on a Mac where "ld" is used instead
               of "g77" for linking.
src/mangle1.4/src/garea.s.f: Bug fix to send errors to stderr.  We had errors
               like "*** from garea: total failure at tol =  3.33161425"
               spilling into the output stream from the Fortran code back
               into IDL, which was corrupting the data.  (Blanton thinks
               this is triggered from balkans with zero area.)

-------------------------------------------------------------------------------
v4_10_7 (Dec 11, 2003)
Tagged for idlspec2d v4_10_7.

Directory pro/rgbcolor added to support making color (RGB) images.
Directory pro/healpix added to support atv display of healpix maps.

ALM2HEALPIX,DPF_NEST2RING,DPF_PIX2ANG_RING,HEAL_REBIN,
               HEAL_SMOOTH,HEALCART_IND,HEALGEN,
               HEALGEN_LB,HEALPIX2ALM,HEALPIX_RING_WEIGHT,HEALNPIX,ISHEALPIX,
               MAP_NEST2RING,MAP_RING2NEST: healpix routines added to
               support using ATV to view healpix-format images.
ATV: Add support for healpix (DPF).
CMP_FITS_FILES: New proc for comparing the contents of two FITS files.
DJS_READILINES: Minor bug fix reported by John Moustakes; need to
               allow setting INDX=[0] and return that first line.
DUSTPLOT: Checking in this old proc for making SFD map figures.
FIRST_READ: Fix possible crash condition if radius > 1 deg, and near RA=0.
HEALNPIX, HEALPIX_CL :  More healpix routine (NP)
HOGG_MAKE_IMAGE_LABEL,NW_ARCSINH,NW_CUT_TO_BOX,
               NW_FLOAT_TO_BYTE,NW_REBIN_IMAGE,NW_SCALE_RBG:
               Hogg's code for generating color (RGB) images.
LOOKBACK: New proc in cosmography routines for computing look-back times.
MQLADVANCE : A healpix routine DPF forgot (NP)
PLOT_POLY: Use SPLOT routine.
POPULATE_IMAGE: If IMAGE is type DOUBLE, then do the assignments in
               double-precision.
REJECT_CR: New proc for detecting CRs by finding features sharper than the PSF.
SPHEREMATCH: Some memory-saving changes by Blanton.
STRUCT_SELECTTAGS: New proc for trimming structures to specified tags.
               This is code broken out of SDSS_READOBJ().
WCSXY2SPH: Comment fix from May version (for HealCart)

data/sdss/sdssMaskbits.par: Change IMAGE_STATUS bit from "CLOUDS" to "CLOUDY".
pro/Makfile: Add reference to healpix,rgbcolor directories.
src/image/Makefile: Add CR code.
src/image/idl_reject_cr_psf.c,reject_cr_psf.c: Code called by REJECT_CR.
src/image/pop_image.c: A double-precision version of the code has been
               added to support the double-precision option in POPULATE_IMAGE.
src/image/p_cisi.c: Get rid of the definition of "TRUE", since that's already
               done in "export.h"
src/mangle1.4/src/Makefile: Add snap.
src/mangle1.4/src/mrb_snap.c: New routine.

-------------------------------------------------------------------------------
v4_10_6 (Oct 15, 2003)
Mostly debugging of mangle Fortran code.
Tagged for idlspec2d v4_10_6.

ASINH: Modified this Goddard routine so that it works for scalars
               as well as arrays.
CCM_FITRV,FUNC_CCM_FITRV: New proc for fitting R_V extinction parameter.
EXTRACT_PROFMEAN,FRAC_PROFMEAN,INTERP_PROFMEAN: Blanton's routines
               for dealing with PHOTO aperature photometry.
MEMSHIFT: New proc for doing raw memory copies within arrays or
               structure arrays.  This is faster than just using
               an IDL assignment statement.
MRDFITS: Re-cast the argument to POINT_LUN to be type LONG64, to allow
               using MRDFITS with > 2 Gb files without errors.  This patch
               has been sent to Landsman.
               Also, recast some other variables as LONG64 to work with
               large files.  Basically, do this to all NAXIS*,THEAP,PCOUNT
               header keywords.
POLYGON_OVERLAP: Added /allow_neg_doubles to call to SET_USE_CAPS.
READ_BINARY_POLYGONS: New proc to read a polygon format binary file
               written by mangle, and return in the IDL structure format.
QU_TO_BAPHI: New proc to transform Q/U values to B/A and PHI.
SET_USE_CAPS: New (undocumented) keyword of /ALLOW_NEG_DOUBLES.
VMID: New proc to return vector within a given balkan polygon.
WHERE_POLYGONS_OVERLAP: New proc to check which polygons overlap a given
               polygon.

bin/evilmake: For compiling on the Mac (Darwin) platform, add the following
               to the X_LD_FLAGS flags: "-flat_namespace -undefined suppress".
               This lets Blanton's spherematch code build, since it needs
               to link to IDL's memory-management routines.  Note that we
               still cannot build the mangle routines on the Mac.
               Blanton changed the following for building Fortran code on Linux:
                MAKE_FTNLIB="-lg2c"
               to have the following:
                "-lg2c  -L/usr/lib/gcc-lib/i386-redhat-linux/`gcc -dumpversion
               I've commented this out, since it fails on all our machines,
               and compiles just fine without it.
data/sdss/sdssMaskbits.par: Add SURVEY_BADFIELD mask bit to RESOLVE_STATUS.
               Add all the IMAGE_STATUS mask bits.
pro/Makefile: Remove radprof from the SUBDIRS list, since there is nothing
               left in that directory.
src/idlmangle/Makefile: Build idl_vmid.c,where_polygons_overlap.c
src/idlmangle/idl_vmid.c: New code called by VMID.
src/idlmangle/where_polygons_overlap.c: New code called by
               WHERE_POLYGONS_OVERLAP.
src/image/Makefile: Include $(MAKE_FTNLIB) options in $(LD) build step.
               Also, build the new Fortran (.f) files, and idl_profmean,
               ppvalu, tautsp, interv, interp_profmean.
               I've now removed the Fortran code from the Makefile, since
               there are problems getting it to link to g2c on all Linux
               platforms.
src/image/idl_interp_profmean.f, interp_profmean.f, interv.f, ppvalu.f,
               tautsp.f: New procs by Blanton for profile interpolation.
src/mangle1.4/src/Makefile: Change the "make" command to put the executables
               directly in the idlutils/bin directory, rather than copying
               them there after a "make install".  And don't have "make"
               automatically do a "make install".
src/mangle1.4/src/GNUmakefile: Remove this file, since it appears to
               be identical to the "Makefile", and I don't really want
               to be worrying about two versions of the same Makefile.
src/mangle1.4/src/format.h, mrb_balkanize.c, msg.c, parse_args.c, vmid.c:
               Fixes for memory-use bugs.
src/mangle1.4/src/copy_poly.c,defaults.h,defines.h,format.h,manglefn.h,
               parse_args.c,wrmask.c: Change to use binary mangle outputs.
src/mangle1.4/src/mrb_unify.c: New function.
src/math/Makfile: Compile memshift.c
src/math/memshift.c: Called by the new IDL procedure MEMSHIFT.

-------------------------------------------------------------------------------
v4_10_5 (Sep 17, 2003)
Upgraded version mangle code, and new features for SPLOT.
Tagged for photoop v1_1.

ADJUST_ERROR: New proc.
ASINH2: Trig function; moved from vagc product.
ASTROM_ENGINE: Fix print statement for "XSHIFT:".
CIRCLE_CAP: Conform to new RA,DEC inputs.
COMDIST2: New proc to compute comoving line-of-sight distances.
CONSTRUCT_POLYGON, READ_MANGLE_POLYGONS: Cleaner memory.
DJS_PHOT,DJS_PHOTSKY,EXACT_PHOTFRAC: Add support for calling the sinc-shift
               "exact" photometry that Lupton uses in PHOTO.  This algorithm
               is called if the /EXACT keyword is set.
FIRST_READ,FIRST_COVERAGE: New functions for reading the FIRST radio survey
               data files.
GVERTS: Fix a loop variable that should have been type long.
               Move from mangle version 1.2 to mangle version 1.4.
IS_IN_CAP,IS_IN_POLYGON,IS_IN_WINDOW: Change calling sequence, with
               ra=,dec=,xyz= instead of assuming xyz is passed.
CONSTRUCT_POLYGON,CONSTRUCT_VERTEX,COPY_CAPS,DESTRUCT_POLYGON,SET_USE_CAPS:
               Get rid of LONG64 in USE_CAPS.
LOGSUM: Small bug fix.
MWRFITS_CHUNKS: Small changes to internal proc MWRBIN_APPEND to allow
               support for files larger than 2 Gb.
               Free all logical units (LUNs), which was not the case.
               We were not freeing one LUN for each time this routine
               was called.
POLYGON_OVERLAP - Blanton changed the usage?
SET_USE_CAPS: Output use_caps separately too.
SPLOT - Fix to address PR #5468, where the IDL system variable !p.position
               is left in a bad state that does not allow the use of !p.multi
               in other plot windows.  The fix is to always make sure that
               !p.position is reset to its previous value after any calls
               to SPLOT,SOPLOT,SXYOUTS.
               If in zoom mode, default to zooming/panning in X, or if shift
               button is pressed then zoom/pan in Y, or if ShiftLock, then
               zoom/pan in X+Y.
               Add SPOLYFILL command, analogous to POLYFILL.
               Make state.xrange,state.yrange,state.position double-precision
               to avoid some round-off problems.
               In the proc splot_autoscale_y, bug fix to set the correct
               limits even if the X plot range runs from big X to small X.
               Change MAXPLOT from 20 thousand to 100 thousand.  Maybe this
               should be changed dynamically rather than hard-wired??
               This now works for 16-bit color under the KDE window manager.
               Get rid of the bit of code that was supposed to make things
               work under 24-bit color, since it *didn't work on my Mac,
               which says it has 24-bit color.
TMASS_ASCII2FITS,TMASS_CONE,TMASS_DECSLICE,TMASS_FITS_FILES,
TMASS_READZONE,TMASS_REFORMAT_PSC,TMASS_STRUC:
               New procs for reading the 2MASS catalog.

bin/evilmake: Changed some of the flags so that C code libraries load
               properly on an IRIX64 machine (sdsshost.apo).  I got these
               flags from "idl_5.5/external/call_external/C/makefile".
               The changed flag values for IRIX64 are:
                 X_CFLAGS="-n32 -KPIC -mips3"
                 CC=cc
                 LD=ld
                 X_LD_FLAGS="-shared -n32 -mips3"
data/sdss/sdssMaskbits.par: Add CALIB_STATUS flag values.
               Add the "UNPLUGGED" value to the ZWARNING flag.
lib/Makefile: For "make clean", also remove all "*.a" files.
src/Makefile: Compile source code in "mangle1.4/src" instead of "mangle1.2".
src/image/idl_photfrac.c, p_cisi.c, p_midpnt.c, p_polint.c, p_qromo.c,
               p_utils.c, ph.h, photfrac.c, test_photfrac.c:
               New tools added by Blanton for band-limited aperature
               photometry (as done by Lupton in PHOTO).
src/mangle1.2/Makefile: For "make install", copy the source code into
               the install directory.  This isn't necessary, but we
               conventionally do it anyway.
src/mangle1.2/mrb_balkanize.c, mwrmask.c: Destroy the polygons as they
               stream out, so that we try to conserve total memory as
               the C outputs are read into the IDL code.
               Print a loop counter after every 100 balkans.
src/mangle1.4: All new source code imported by Blanton from Andrew Hamilton,
               replacing mangle1.2 files.
src/mangle1.4/mrb_balkanize.c: Clear memory usage when possible
               when assigning parents.
ups/idlutils.table: Add optional dependencies upon these products: dust,
               first, gsc, twomass, tycho2, ucac, usno.
               Get rid of all the $UPS_PROD_FLAVOR references for
               dependent products.

In the Goddard utitilies:
MRDFITS: Modified by Wayne Landsman to have the ROWS keyword.
               (See e-mail exchange with him on 24-Jul-2003).

-------------------------------------------------------------------------------
v4_10_4 (Jul 5, 2003)
Tagged for photoop v0_12.

MWRFITS_CHUNKS- Added /APPEND option.
UCAC_READGC - Check to see if outdat has any elements.
USNO_READGC - Check to see if outdat has any elements.

-------------------------------------------------------------------------------
v4_10_3 (Jun 27, 2003)
Tagged for photoop v0_10.

ATV          - Merged with Aaron Barth's version 1.4 (by Finkbeiner).
               Merged to include using SPLOT/SOPLOT instead of PLOT,
               use 5 digit pixel coords, some Healpix support (though
               the libraries are not yet in idlutils).
               Fink did not merge in support for reversed CTYPE values
               in FITS headers, e.g. DEC,RA instead of RA,DEC.
CAP_DISTANCE: New function, moved from photoop/RESOLVE_RUN_LOCAL.
GVERTS: Fix zero-area failure.
MUNU_TO_RADEC,RADEC_TO_MUNU: Computation of PHI now done properly in both
               routines, and done analytically rather than numerically.
               Before this, I at least had a correct numerical computation
               in MUNU_TO_RADEC.
src/mangle1.2/balkanize.c, harmonize.c, poly2poly.c, ransack.c,
               snap.c, unify.c - Fixed ransack bug where it wasn't
               checking for NULL polygons after throwing them away.

-------------------------------------------------------------------------------
v4_10_2 (Jun 20, 2003)
Tagged for photoop v0_9.  Make sure that mangle code builds.

data/sdss/sdssMaskbits.par: Add RESOLVE_STATUS flag, which probably
                deprecates the RESOLVE flag.
lib/Makefile: When installing, copy over *.a files and Makefile, not 
                that they're needed.
src/Makefile: Note that mangle1.2 must be built before idlmangle!
                This prevented the mangle code from building in v4_10_0,v4_10_1.
src/idlmangle/Makfile: Copy source code when installing, not that it's needed.

-------------------------------------------------------------------------------
v4_10_1 (Jun 18, 2003)
Tagged for photoop v0_9.  Also ATV bug fixes for IDL 5.5 and later.

ATV           - Call PSCONFIG instead of CMPS_FORM for making PostScript
                plots.  This change was necessary to work with IDL 5.5.
ATV_JOE_WRITEPS - Write a PostScript file of the current ATV display
                w/out using a widget
CROSSPROD     - New function to compute cross product of two vectors or
                arrays of vectors.
DJS_BATCH     - Fix bug introduced when SELECTHOST option was added.
FINDOPFILE    - This routine was hard-wired to a 5-digit MJD, but
                we need it to work for numbers with any number of digits.
                For example, for the photoop product, we use this routine
                to select from 6-digit run numbers (like for flat files).
FSC_DROPLIST,FSC_FIELD,FSC_FILESELECT,FSC_INPUTFIELD,FSC_PLOTWINDOW,
FSC_PSCONFIG__DEFINE,PSCONFIG - New routines downloaded from David Fanning
                for use with ATV.  Downloaded from:
                "http://www.dfanning.com/documents/programs.html#FSCPSCONFIG"
GROW_OBJECT   - New proc to identify objects as the contiguous non-zero pixels
                in an image.  This calls a C program.
TNMIN         - Two loop variables (lines 559 and 601) changed from "0"
                to "0L".
UCAC_READZONE - New function to read the raw UCAC data files for a specific
                declination zone within a given RA range.
USNO_READGC   - New proc to read the UCAC data files for a great circle
                on the sky, analogous to UCAC_READGC.
WCSXY2SPH     - Add HealCart projection.
YANNY_READ    - Don't crash when FILENAME is a 1-element array!
                The last step trims each structure to the actual number
                of elements.  Be sure to free memory from the untrimmed,
                unused pointers.
YANNY_READONE - Free pointers before returning.

bin/Makefile  - Take out "evilinstall" which has now moved to evilups product.
src/image/grow_obj.c - New code for IDL proc GROW_OBJECT.
src/math/nr.h - Comment-out line 93 which defines "float fmin(float x[]);".
               This conflicts with a definition in one of the include files
               under Mac OS X: "/usr/include/architecture/ppc/math.h".
               Note that we don't actually use the fmin() function anywhere
               in this directory anyway.
ups/Makefile - Get rid of the confusing dependency on
               $(SDSSTOOLS_DIR)/bin/install_ups_table.

In the Goddard utitilies:
MATCH         - Simple fix to allow this to work with scalar values.

-------------------------------------------------------------------------------
v4_10_0 (Mar 29, 2003)
Tagged for photoop v0_6, and includes updated Goddard libraries.

data/filters/Makefile - This file is no longer needed, since the Makefile
               one directory up takes care of copying these filter files.
pro/Makefile - This was missing several subdirectories.
goddard      - This library was brought up to the 2003-Mar-21 version
               of Landsman's library.  There were changes to 192 files
               in the past 14 months.

-------------------------------------------------------------------------------
v4_9_14 (Mar 25, 2003)
Tagged for photoop v0_5.

