#!/bin/sh

# Do not use optimization for the IRIX platforms, since that
# seems to fail at the build step.
# Our Makefile's always build with $(SDSS_CFLAGS), so we can use that
# variable to set optimization.

UNAME=`uname`
echo "OS type detected: "$UNAME
case $UNAME in
	"SunOS") if [  -d /proc ]; then
			SO_EXT=so
			X_CFLAGS="-KPIC"
      X_FFLAGS="-e"
			X_LD_FLAGS=-G
		fi
		SDSS_CFLAGS=-O3
	;;
	"HP-UX")
		SO_EXT=sl
		X_CFLAGS="+z -Aa -D_HPUX_SOURCE"
	  X_FFLAGS="-extend_source"
		X_LD_FLAGS=-b
	;;
	"IRIX" )
		SO_EXT=so
		X_CFLAGS="-32 -KPIC"
    X_FFLAGS="-32 -extend_source"
    MAKE_FTNLIB="-lftn"
		X_LD_FLAGS="-shared -32"
	;;
	"IRIX64" )
		SO_EXT=so
		X_CFLAGS="-n32 -KPIC -mips3"
		CC=cc
		LD=ld
    X_FFLAGS="-32 -extend_source -KPIC"
    MAKE_FTNLIB="-lftn"
		X_LD_FLAGS="-shared -n32 -mips3"
	;;
	"OSF1" )
		SO_EXT=so
    X_FFLAGS="-extend_source"
		X_LD_FLAGS="-S -shared"
		SDSS_CFLAGS=-O3 
	;;
	"Darwin" )
		F77=g77
		SO_EXT=so
		X_LD_FLAGS="-bundle /usr/lib/bundle1.o -L/usr/lib -lc -lcc_dynamic"
# The following two lines should be equivalent to the above line
#		LD=libtool
#		X_LD_FLAGS="-dynamic -L/usr/lib -lc -lcc_dynamic"
		X_CFLAGS="-g -Wall -dynamic"
		SDSS_CFLAGS=-O3
	;;
	"Linux" )
		SO_EXT=so
		X_CFLAGS="-fPIC -g -Wall"
		X_FFLAGS="-ffixed-line-length-none"
    MAKE_FTNLIB="-lg2c"
		X_LD_FLAGS=-shared
		SDSS_CFLAGS="-O3 -DSDSS_LITTLE_ENDIAN"
	;;
	*) echo "This system is not supported" >&2
		exit 1;;
esac

export SO_EXT X_CFLAGS X_FFLAGS X_LD_FLAGS SDSS_CFLAGS LD F77 MAKE_FTNLIB UNAME

make "$@"
